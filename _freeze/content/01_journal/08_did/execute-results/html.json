{
  "hash": "7db1dbede19c98e05602dccc28d18eda",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\nauthor: \"Yazan Dabbas\"\ndate: \"12/22/2023\"\nformat: \n    html:\n      code-line-numbers: true\n      df-print: paged\n---\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_bb64397f2c4691b038da2987a2a4289b'}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(dplyr)\nlibrary(readr)\nlibrary(lmtest)\n```\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_f5591af1f860904fec86585bce88b1c7'}\n\n```{.r .cell-code}\n# Load the data\ndata <- readRDS('C:/Master Degree/Core Qualification_Compulsory Courses/Business/Causal_Data_Science/Data/Causal_Data_Science_Data/hospdd.rds')\n\n# Be familiar with the data\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hospital\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"frequency\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"month\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"procedure\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satis\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"3\",\"3\":\"7\",\"4\":\"1\",\"5\":\"4.106527\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"3\",\"4\":\"0\",\"5\":\"3.319475\"},{\"1\":\"1\",\"2\":\"4\",\"3\":\"2\",\"4\":\"0\",\"5\":\"3.411720\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"4\",\"4\":\"1\",\"5\":\"3.004025\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"3\",\"4\":\"0\",\"5\":\"3.110720\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"7\",\"4\":\"1\",\"5\":\"2.882164\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n#### **1. Manually compute the mean satisfaction for treated and control hospitals before and after the treatment**\n\n----\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-3_2d4bebd6ee64ef085739832611a7aa19'}\n\n```{.r .cell-code}\n# The month after that they introduced the new admission \nthreshold_month <- 3.0\n\n# The hospital-ID, after which the others are not treated\nthreshold_hospital <- 18\n\n# Convert Month and hospital columns into numeric\ndata$month <- as.numeric(data$month)\ndata$hospital <- as.numeric(data$hospital)\n\n# Split the data into treated and controlled groups\ntreated_group <- data %>%\n  filter(hospital <= 18 )\n\ncontrol_group <- data %>%\n  filter(hospital > 18 )\n\n\n# Mean Difference between treatment and control group BEFORE treatment\nbefore_control_mean <- control_group %>% \n  filter(month <= threshold_month) %>%\n  summarise(mean_satisfaction = mean(satis)) %>%\n  pull(mean_satisfaction)\n\nbefore_treatment_mean  <- treated_group %>% \n  filter( month <= threshold_month) %>%\n  summarise(mean_satisfaction = mean(satis)) %>%\n  pull(mean_satisfaction)\n\n\nmean_diff_before <- before_treatment_mean - before_control_mean\n\n\n# Mean Difference between treatment and control group AFTER treatment\nafter_control_mean <- control_group %>% \n  filter(month > threshold_month) %>%\n  summarise(mean_satisfaction = mean(satis)) %>%\n  pull(mean_satisfaction)\n\nafter_treatment_mean <- treated_group %>% \n  filter( month > threshold_month) %>%\n  summarise(mean_satisfaction = mean(satis)) %>%\n  pull(mean_satisfaction)\n\n\nmean_diff_after <- after_treatment_mean - after_control_mean\n\n\n# Difference-in-differences\n\nmean_diff_diff <- mean_diff_after - mean_diff_before\n```\n:::\n\n#### **2. Use linear regression to compute the estimate with group and time fixed effects**\n\n----\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-4_4538e54e8077153b0f0b2a550a45051b'}\n\n```{.r .cell-code}\n# Fit the linear regression model\nmodel <- lm(satis ~ procedure * as.factor(month) + as.factor(hospital) , data)\n\n# Print the results\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ procedure * as.factor(month) + as.factor(hospital), \n#>     data = data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.1880 -0.4630  0.0024  0.4540  4.3181 \n#> \n#> Coefficients: (3 not defined because of singularities)\n#>                               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                  3.1716566  0.0562244  56.411  < 2e-16 ***\n#> procedure                    0.8785070  0.0541087  16.236  < 2e-16 ***\n#> as.factor(month)2           -0.0096077  0.0292138  -0.329 0.742261    \n#> as.factor(month)3            0.0219686  0.0292138   0.752 0.452080    \n#> as.factor(month)4            0.0152441  0.0368748   0.413 0.679326    \n#> as.factor(month)5           -0.0246564  0.0368748  -0.669 0.503740    \n#> as.factor(month)6            0.0055796  0.0368748   0.151 0.879734    \n#> as.factor(month)7           -0.0238856  0.0368748  -0.648 0.517169    \n#> as.factor(hospital)2         0.4085664  0.0772468   5.289 1.26e-07 ***\n#> as.factor(hospital)3         0.5336248  0.0793436   6.725 1.88e-11 ***\n#> as.factor(hospital)4         0.2275102  0.0739460   3.077 0.002101 ** \n#> as.factor(hospital)5        -0.1453529  0.0739460  -1.966 0.049375 *  \n#> as.factor(hospital)6         0.4478634  0.0739460   6.057 1.46e-09 ***\n#> as.factor(hospital)7         1.4044164  0.0714606  19.653  < 2e-16 ***\n#> as.factor(hospital)8         0.0718758  0.0763236   0.942 0.346365    \n#> as.factor(hospital)9        -1.5185150  0.0782498 -19.406  < 2e-16 ***\n#> as.factor(hospital)10        1.6828446  0.0772468  21.785  < 2e-16 ***\n#> as.factor(hospital)11        0.2209653  0.0763236   2.895 0.003801 ** \n#> as.factor(hospital)12       -0.0953034  0.0782498  -1.218 0.223287    \n#> as.factor(hospital)13        0.4955931  0.0754708   6.567 5.50e-11 ***\n#> as.factor(hospital)14        0.2330426  0.0793436   2.937 0.003323 ** \n#> as.factor(hospital)15       -0.1444935  0.0793436  -1.821 0.068631 .  \n#> as.factor(hospital)16        1.4142680  0.0772468  18.308  < 2e-16 ***\n#> as.factor(hospital)17        0.4235429  0.0805415   5.259 1.49e-07 ***\n#> as.factor(hospital)18        0.1532761  0.0938225   1.634 0.102369    \n#> as.factor(hospital)19       -0.7453017  0.0811676  -9.182  < 2e-16 ***\n#> as.factor(hospital)20        0.0473874  0.0791192   0.599 0.549234    \n#> as.factor(hospital)21        1.1943370  0.0836287  14.281  < 2e-16 ***\n#> as.factor(hospital)22        0.7993153  0.0823390   9.708  < 2e-16 ***\n#> as.factor(hospital)23        0.7017202  0.0811676   8.645  < 2e-16 ***\n#> as.factor(hospital)24       -0.3081260  0.0866459  -3.556 0.000379 ***\n#> as.factor(hospital)25        0.6464736  0.0927319   6.971 3.41e-12 ***\n#> as.factor(hospital)26        0.2142471  0.0791192   2.708 0.006787 ** \n#> as.factor(hospital)27       -0.3986544  0.0766156  -5.203 2.01e-07 ***\n#> as.factor(hospital)28        0.7119953  0.0836287   8.514  < 2e-16 ***\n#> as.factor(hospital)29        0.2485512  0.0800987   3.103 0.001923 ** \n#> as.factor(hospital)30       -0.1679220  0.0953700  -1.761 0.078324 .  \n#> as.factor(hospital)31        0.5120848  0.0791192   6.472 1.03e-10 ***\n#> as.factor(hospital)32       -0.3233456  0.0800987  -4.037 5.47e-05 ***\n#> as.factor(hospital)33       -0.4539752  0.0791192  -5.738 9.97e-09 ***\n#> as.factor(hospital)34       -0.0004123  0.0746103  -0.006 0.995591    \n#> as.factor(hospital)35        0.3541110  0.0766156   4.622 3.87e-06 ***\n#> as.factor(hospital)36        2.1381425  0.0773862  27.630  < 2e-16 ***\n#> as.factor(hospital)37        0.1404036  0.0927319   1.514 0.130049    \n#> as.factor(hospital)38       -0.0868060  0.0782181  -1.110 0.267124    \n#> as.factor(hospital)39       -0.0234969  0.0823390  -0.285 0.775370    \n#> as.factor(hospital)40        1.1215331  0.0782181  14.339  < 2e-16 ***\n#> as.factor(hospital)41       -0.1497346  0.0766156  -1.954 0.050697 .  \n#> as.factor(hospital)42        0.8811369  0.0850564  10.359  < 2e-16 ***\n#> as.factor(hospital)43       -0.7724325  0.0811676  -9.517  < 2e-16 ***\n#> as.factor(hospital)44        0.0344120  0.0904396   0.380 0.703588    \n#> as.factor(hospital)45       -0.2137495  0.0766156  -2.790 0.005286 ** \n#> as.factor(hospital)46        0.0784915  0.0823390   0.953 0.340484    \n#> procedure:as.factor(month)2         NA         NA      NA       NA    \n#> procedure:as.factor(month)3         NA         NA      NA       NA    \n#> procedure:as.factor(month)4 -0.0750732  0.0684427  -1.097 0.272731    \n#> procedure:as.factor(month)5  0.0061613  0.0684427   0.090 0.928272    \n#> procedure:as.factor(month)6 -0.0531645  0.0684427  -0.777 0.437317    \n#> procedure:as.factor(month)7         NA         NA      NA       NA    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7239 on 7312 degrees of freedom\n#> Multiple R-squared:  0.5334,\tAdjusted R-squared:  0.5299 \n#> F-statistic:   152 on 55 and 7312 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n::: {.callout-important appearance=\"minimal\"}\n\n-   **When you use `month + hospital` in regression, R treats these variables as numeric, and each level gets its own coefficient. This implies a linear trend for months and a linear effect for each hospital. This might not be appropriate for months and hospitals, which are better modeled as categorical factors.**\n\n-   **On the other hand, `as.factor(month) + as.factor(hospital)` treats both months and hospitals as factors, assigning a separate intercept for each level. This is more appropriate when dealing with categorical variables like months and hospitals because it allows for different intercepts for each level rather than assuming a linear relationship.**'\n\n-   **Using `as.factor(month) + as.factor(hospital)` is more suitable for this analysis, as it captures the categorical nature of months and hospitals, allowing for separate effects for each level**\n\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}